@using PhoneShop.ModelViews
﻿@using PhoneShop.Models
@using PhoneShop.Extension
@model CartItemViewModel
@{


    List<ImageProductViewModel> IsCourseContents = ViewBag.imageproduct;
    VoucherItemViewModel IsVoucherVM = ViewBag.voucherVM;
    // List<ProductViewModel> IsProduct = ViewBag.RelatedProduc;
    //format tien

    // Lấy mã vùng địa phương cho tiếng Việt nếu có, nếu không thì chọn một mã vùng khác
    CultureInfo culture = CultureInfo.GetCultures(CultureTypes.SpecificCultures)
                                    .FirstOrDefault(c => c.Name.StartsWith("vi", StringComparison.OrdinalIgnoreCase))
                           ?? CultureInfo.CurrentCulture;

    int tienO = 0;


    List<ProductViewModel> List_Selling = ViewBag.ListSelling;

}
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@if (TempData["Check_Quantity_Product"] != null)
{
    <div class="alert alert-success">
        @TempData["Check_Quantity_Product"]
    </div>
}
@if (TempData["VoucherNull"] != null)
{
    <div class="alert alert-success">
        @TempData["VoucherNull"]
    </div>
}
@if (TempData["OutOfDiscount"] != null)
{
    <div class="alert alert-danger">
        @TempData["OutOfDiscount"]
    </div>
}
@if (TempData["ValueNull"] != null)
{
    <div class="alert alert-danger">
        @TempData["ValueNull"]
    </div>
}
@if (TempData["VoucherNull_Cart"] != null)
{
    <div class="alert alert-danger">
        @TempData["VoucherNull_Cart"]
    </div>
}

@if (TempData["ApplySuccess"] != null)
{
    <div class="alert alert-danger">
        @TempData["ApplySuccess"]
    </div>
}

@* @if (TempData["OrderSuccess"] != null)
{
    <div class="alert alert-success">
        @TempData["OrderSuccess"]
    </div>
} *@

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>
    .minus {
        font-size: 20px;
        color: #000;
        text-decoration: none;
    }

        .minus:hover {
            color: #888;
            text-decoration: none;
        }

    td.product-name {
        font-size: 14px;
    }

    table.shop_table th {
        
        font-size: 13px;
       
    }


</style>
<div class="container">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item" style="font-size: 18px;"><a href="/~">Trang chủ</a></li>
            <li class="breadcrumb-item active" style="font-size: 18px;" aria-current="page">Giỏ hàng</li>
        </ol>
    </nav>

</div>

<div class="single-product-area" style="padding-top:30px">
  
    <div class="zigzag-bottom"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-4">


                <div class="single-sidebar">
                    <h2 class="sidebar-title">Bài đăng gần đây</h2>

                   @*  @foreach (var itemm in IsProduct)
                    {
                        <div class="thubmnail-recent">
                            <img src="~/images/Product/@itemm.ImageDefaultName" class="recent-thumb" alt="">
                            <h2><a href="">@itemm.Title</a></h2>
                            <div class="product-sidebar-price">
                                @{
                                    if (itemm.Discount == 0 || itemm.Discount == null || itemm.Discount is string)
                                    {
                                        <ins>
                                            @{
                                                string formattedPrice = PhoneShop.Extension.Extension.ToVnd((double)itemm.Price); // "C" là định dạng tiền tệ
                                            }
                                            @formattedPrice
                                        </ins>
                                    }
                                    else
                                    {
                                        <ins>
                                            @{
                                                string formattedPrice = PhoneShop.Extension.Extension.ToVnd((double)itemm.Discount); // "C" là định dạng tiền tệ
                                            }
                                            @formattedPrice
                                        </ins>
                                    }
                                }

                                <del>
                                    @{
                                        string formattedPriceee;
                                        if (itemm.Discount > 0)
                                        {
                                            formattedPriceee = PhoneShop.Extension.Extension.ToVnd((double)itemm.Price); // "C" là định dạng tiền tệ
                                        }
                                        else
                                        {

                                            formattedPriceee = PhoneShop.Extension.Extension.ToVnd(tienO); // "C" là định dạng tiền tệ
                                        }


                                    }
                                    @formattedPriceee




                                </del>
                            </div>
                        </div>
                    } *@



                </div>


            </div>

            <div class="col-md-8">
                <div class="product-content-right">
                    <div class="woocommerce">
                        <form method="post" asp-action="CheckOut" asp-controller="Cart" >
                            <table cellspacing="0" class="shop_table cart">
                                <thead>
                                    <tr>
                                        <th class="product-remove">&nbsp;</th>
                                        <th class="product-thumbnail">&nbsp;</th>
                                        <th class="product-name">Sản phẩm</th>
                                        <th class="product-price">Giá</th>
                                        <th class="product-quantity">Số lượng</th>
                                        <th class="product-subtotal">Thành tiền</th>
                                    </tr>
                                </thead>
                                <tbody>

                                    @if(Model.CartItems.Count > 0)
                                    {
                                        @foreach(var item in Model.CartItems)
                                        {
                                            <tr class="cart_item" id="trow_@item.ProductId">
                                                <td >
                                                    <a class="btnDelete"  data-id="@item.ProductId">x</a>
                                                </td>

                                                <td class="product-thumbnail">
                                                    <a href="single-product.html"><img width="145" height="145" alt="poster_1_up" class="shop_thumbnail" src="~/images/Product/@item.DataNameImage"></a>
                                                </td>

                                                <td class="product-name">
                                                    <a href="single-product.html">@item.ProductName</a>
                                                </td>

                                                <td class="product-price">
                                                    @{
                                                        string formattedPrice = PhoneShop.Extension.Extension.ToVnd((double)item.Price); // "C" là định dạng tiền tệ

                                                    }
                                                   
                                                    <span class="amount">@formattedPrice</span>
                                                </td>

                                                <td class="product-quantity">
                                                    <div class="quantity buttons_added">
                                                        <a asp-action="tru" asp-controller="Cart" asp-route-id="@item.ProductId" class="btn btn-link minus" style="font-size: 12px;"><i class="fa fa-minus"></i></a>
                                                        <input type="number" size="4" class="input-text qty text" title="Qty" value="@item.Quantity" min="0" step="1" readonly style="font-size: 12px;">
                                                        <a asp-action="cong" asp-controller="Cart" asp-route-id="@item.ProductId" class="btn btn-link minus" style="font-size: 12px;"><i class="fa fa-plus"></i></a>
                                                    </div>
                                                </td>

                                                <td class="product-subtotal">
                                                    @{
                                                        string formattedPriceTotal = PhoneShop.Extension.Extension.ToVnd((double)item.Total); // "C" là định dạng tiền tệ

                                                    }

                                                    <span style="color:red" class="amount">@formattedPriceTotal</span>
                                                </td>
                                            </tr>
                                        }
                                    }
                                    else{
                                        <td colspan="6" class="product-name">
                                            <a style="color:red" href="single-product.html">Giỏ hàng rỗng không thể thanh toán 

                                                

                                        </a>
                                    </td>

                                    }
                                    

                                   
                                    <tr>
                                        <td class="actions" colspan="6">
                                           @*  <div class="coupon">
                                                <label for="coupon_code">Coupon:</label>
                                                <input type="text" placeholder="Coupon code" value="" id="coupon_code" class="input-text" name="coupon_code">
                                                <input type="submit" value="Apply Coupon" name="apply_coupon" class="button">
                                            </div> *@
                                           @*  <input type="submit" value="Update Cart" name="update_cart" class="button"> *@
                                           
                                            @if (User.Identity.IsAuthenticated && (User.IsInRole("Staff")))
                                            {
                                                <input type="submit" value="Thanh Toán" name="proceed" class="checkout-button button alt wc-forward">

                                            }
                                            else
                                            {
                                            <p>Bạn chưa đăng nhập. <a class="btn btn-success" href="/Login.html">Đăng nhập</a></p>
                                            }

                                        </td>

                                    </tr>

                                </tbody>

                            </table>
                        </form>

                        <div class="coupon">
                            <form method="post" asp-action="ApplyVoucher" asp-controller="Cart">
                                <label for="coupon_code">Áp dụng khuyến mãi:</label>
                                <input type="text" placeholder="mã giảm giá" value="" id="coupon_code" class="input-text" name="Voucher_code">
                               
                                <input type="submit" value="Áp dụng" name="áp dụng" class="button">
                            </form>
                            <h5>Danh sách mã giảm giá</h5>
                            @foreach (var i in IsVoucherVM.VoucherItems)
                            {
                                <p>@i.Code</p>
                            }
                        </div>
                        <br />

                        <div class="cart-collaterals">


                         


                            <div class="cart_totals ">
                                <h2>Tổng giỏ hàng</h2>

                                <table cellspacing="0">
                                    <tbody>
                                        <tr class="cart-subtotal">
                                            <th>Tổng giỏ hàng</th>
                                            @{
                                                string formattedGrandTotal = ViewBag.GrandTotal.ToString("C", culture); // "C" là định dạng tiền tệ

                                            }
                                            <td><span class="amount">@formattedGrandTotal</span></td>
                                        </tr>

                                        <tr class="shipping">
                                            <th>Vận chuyển</th>
                                            <td>Free Shipping</td>
                                        </tr>

                                        <tr class="order-total">
                                            <th>Tổng đơn hàng</th>
                                            @{
                                                string OrderTotal = ViewBag.OrderTotal.ToString("C", culture); // "C" là định dạng tiền tệ

                                            }
                                            <td><strong><span class="amount">@OrderTotal</span></strong> </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>




                        </div>
                  
                                <div class="row">

                                    <div style="margin-bottom: 10px;" class="section-title">
                                        <h3 style="text-align: left; margin-bottom:0PX;">Bán Chạy </h3>
                                    </div>


                                    @if (Model != null)
                                    {
                                        foreach (var item in List_Selling)
                                        {
                                            <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-2">
                                                <div class="single-product">
                                                    <div class="product-f-image">
                                                        @*                                         <img src="~/User/img/product-1.jpg" alt="">
                                                *@            <img src="~/images/Product/@item.ImageDefaultName" style="border: solid 1px;height:270px; width:180px" />

                                                        <div class="product-hover">
                                                            <a class="add-to-cart-link confirmAdd" data-id="@item.Id"><i class="fa fa-shopping-cart"></i> Thêm vào giỏ</a>
                                                            <a href="/chi-tiet/@item.Alias-@item.Id" class="view-details-link"><i class="fa fa-link"></i> Xem chi tiết</a>
                                                        </div>
                                                    </div>
                                                    <div style="height:60px">  <h4><a href="single-product.html">@item.Title</a></h4></div>


                                                    <div class="product-carousel-price">


                                                         @{
                                                                      if (item.Discount == 0 || item.Discount == null || item.Discount is string)
                                                                    {
                                                                    <ins>
                                                                    @{






                                                                    string formattedprice = PhoneShop.Extension.Extension.ToVnd((double)item.Price);

                                                                    }
                                                                    @formattedprice
                                                                    </ins>
                                                                    }
                                                                    else
                                                                    {
                                                                    <ins>
                                                                    @{





                                                                string formattedprice = PhoneShop.Extension.Extension.ToVnd((double)item.Discount);


                                                                    }
                                                                    @formattedprice
                                                                    </ins>
                                                                    }
                                                          } 

                                                        <del>
                                                            @{
                                                                string formattedPrice2;
                                                                if (item.Discount > 0)
                                                                {

                                                                    formattedPrice2 = PhoneShop.Extension.Extension.ToVnd((double)item.Price);
                                                                }
                                                                else
                                                                {


                                                                    formattedPrice2 = PhoneShop.Extension.Extension.ToVnd((double)tienO);
                                                                }


                                                            }
                                                            @formattedPrice2




                                                        </del>
                                                    </div>

                                                </div>
                                            </div>
                                        }
                                    }
                                   
                                    <!-- Các sản phẩm tiếp theo -->
                       
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@section Scripts{
    
    <script>
        $(document).ready(function () {
            $('body').on('click', '.btnDelete', function () {
                var id = $(this).data('id');

                var conf = confirm("ban muon xoa chua"+id);

                if (conf == true) {

                    $.ajax({

                        url: '/Cart/Delete',
                        type: 'post',
                        data: { id: id },
                        success: function (rs) {
                            if (rs.success) {
                                $('trow_' + id).remove();
                                // alert(rs.msg);
                                location.reload();
                            }
                        }

                    });

                }
            });
        });
    </script>


}