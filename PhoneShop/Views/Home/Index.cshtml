﻿@using PagedList.Core.Mvc
@using System.Globalization;﻿
@using PhoneShop.Models
@using PhoneShop.ModelViews
@using PhoneShop.Extension
@using PhoneShop.Data

@model List<PhoneShop.ModelViews.ProductViewModel>

@{


    List<CategoryModelView> ListLogo = ViewBag.ListLogo;

    List<ImageProductViewModel> IsCourseContents = ViewBag.imageproduct;

    List<BannerViewModel> banneViews = ViewBag.ListBanner;


    List<ProductViewModel> ListDiscountProduct = ViewBag.ListDiscountProduct;

    // List<ProductViewModel> IsSelling_Products  = ViewBag.Selling_Products;

    int tienO = 0;

    List<ProductViewModel> List_Selling = ViewBag.ListSelling;
    List<ProductViewModel> New_Product = ViewBag.New_Product;

    List<Product> List_CollaborativeFiltering = new List<Product>();
    List<CollaborativeFiltering_DataProduct> List_CollaborativeFiltering_Rating = new List<CollaborativeFiltering_DataProduct>();
    if (ViewBag.CheckAccount == 1)
    {
        List_CollaborativeFiltering = ViewBag.CollaborativeFiltering_List;

        List_CollaborativeFiltering_Rating = ViewBag.CollaborativeFiltering_List_Rating;
    }



}






<link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">



<style>
    .star-container {
        font-size: 24px;
    }

    .filled {
        color: gold; 
    }

    .half-filled {
        color: gold; 
    }

    
    .star-container .fa-star-o {
        color: lightgray;
    }
    .product-section-title {
        text-align: center; 
        margin-bottom: 10px;
       
    }
    .divborder{
        width:100px;
        border-bottom: 1px solid;
        margin:auto;
        color: #5a88ca;
    }

        .product-section-title h3 {
            font-size: 24px; 
            margin-bottom: 0; 
            position: relative;
            color: #333;
        }

           



    .col-md-12 {
        padding: 0px;
    }

    .section-title {
        font-family: "Raleway", sans-serif;
        font-size: 50px;
        font-weight: 100;
        text-align: center;
        background: #B0D4B8;
        border-radius: 8px;
        padding: 10px;
        font-weight: bold;
    }

    .section-title {
        font-size: 22px;
        font-weight: bold;
        text-align: left;
        color: #333;
        background-color: #f6f6f6;
        border-bottom: 2px solid #ddd;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

        .section-title:before,
        .section-title:after {
            content: "";
            display: block;
            width: 50px;
            height: 2px;
            background-color: #333;
            margin: 10px 0;
        }

    .discount-label {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: #e74c3c;
        color: #fff;
        padding: 5px 10px;
        font-size: 14px;
        font-weight: bold;
        border-radius: 3px;
    }

        .discount-label span {
            display: inline-block;
            transform: skewX(-15deg);
        }
</style>
@ViewBag.accountId

<div class="slider-area">
    <!-- Slider -->
    <div class="block-slider block-slider4">
        <ul class="" id="bxslider-home4">

            @await Html.PartialAsync("_Partial_Banner_Images",banneViews)
        </ul>
    </div>
    <!-- ./Slider -->
</div> <!-- End slider area -->

<div class="promo-area">
    <div class="zigzag-bottom"></div>
    <div class="container">
        <div class="row">
            <a href="~/">
                <div class="col-md-3">
                    <div class="service-box">
                        <div class="icon-icon">
                            <i class="fa fa-truck"></i>
                        </div>

                        <h4 style="color:black">Giao hàng siêu tốc</h4>
                        <p style="color:black">Giao hàng trong 24h</p>
                    </div>
                </div>
            </a>
            <a href="~/">
                <div class="col-md-3">
                    <div class="service-box">
                        <div class="icon-icon">
                            <i class="fa fa-headphones"></i>
                        </div>
                        <h4 style="color:black">Tư vấn miễn phí</h4>
                        <p style="color:black">Đội ngũ tư vấn tận tình</p>
                    </div>
                </div>
            </a>
            <a href="~/">
                <div class="col-md-3">
                    <div class="service-box">
                        <div class="icon-icon">
                            <i class="fa fa-credit-card"></i>
                        </div>
                        <h4 style="color:black">Thanh toán</h4>
                        <p style="color:black">Thanh toán an toàn</p>
                    </div>
                </div>
            </a>
            <a href="/voucher.html">
                <div class="col-md-3">
                    <div class="service-box">
                        <div class="icon-icon">
                            <i class="fa fa-gift"></i>
                        </div>
                        <h4 style="color:black">Giải pháp quà tặng</h4>
                        <p style="color:black">Dành cho doanh nghiệp</p>
                    </div>
                </div>
            </a>
           
        </div>
    </div>
</div>
@if (ViewBag.CheckAccount == 1)
{
    @await Html.PartialAsync("_Partial_CollaborativeFiltering",List_CollaborativeFiltering)

    @await Html.PartialAsync("_Partial_CollaborativeFiltering_Rating",List_CollaborativeFiltering_Rating)
}


@await Html.PartialAsync("_Partial_NewProducts_Home",New_Product)
@await Html.PartialAsync("_Partial_ListCategory_Home",ListLogo)
@await Html.PartialAsync("_Partial_DiscountProducts_Home",ListDiscountProduct)


<div class="product-widget-area">
    <div class="zigzag-bottom"></div>
    <div class="container">
        <div class="row" style="background:white;padding-bottom: 15px;padding:0px 10px">
            <br />
            <div class="product-section-title">
                <b style="font-size:2rem">SẢN PHẨM BÁN CHẠY</b>
                <div class="divborder"></div>
                <p style="font-size:1,25rem">Mua Sắm Thả Ga - Không Lo Về Giá!</p>
            </div>

            @if (Model != null)
            {
                foreach (var item in List_Selling)
                {
                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-2">
                        <div class="single-product" style="padding-bottom:10px">
                            <div class="product-f-image" style="display: flex; justify-content: center; align-items: center; position: relative;">
                                <img src="~/images/Product/@item.ImageDefaultName" style="height:296px; width:220px" />
                                @* tinh % giam gia *@
                                @if(item.Discount > 0)
                                {
                                    //format discount
                                        decimal discount = 0;
                                        discount = (item.Price - item.Discount) / item.Price * 100;
                                        discount = Math.Round(discount);
                                    //format discount
                                    <div class="discount-label">
                                        <span>Giảm @discount%</span>
                                    </div>
                                }
                                @* tinh % giam gia *@

                                <div class="product-hover">
                                    <a class="add-to-cart-link confirmAdd" data-id="@item.Id"><i class="fa fa-shopping-cart"></i> Thêm vào giỏ</a>
                                    <a href="/chi-tiet/@item.Alias-@item.Id" class="view-details-link"><i class="fa fa-link"></i> Xem chi tiết</a>
                                </div>
                            </div>

                            <div style="height:45px">
                                <h2><a style="height:45px" href="/chi-tiet/@item.Alias-@item.Id">@item.Title </a></h2>
                            </div>
                            <div id="stars-container">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    if (i <= Math.Floor(item.Rating))
                                    {
                                        <i class="fa fa-star filled"></i> <!-- Sao đầy -->
                                    }
                                    else if (i == Math.Ceiling(item.Rating))
                                    {
                                        <i class="fa fa-star-half-o half-filled"></i> <!-- Sao nửa -->
                                    }
                                    else
                                    {
                                        <i class="fa fa-star-o"></i> <!-- Sao rỗng -->
                                    }
                                }
                            </div>
                            <div class="product-carousel-price" style="color:blue">Đã bán: @item.Quantity_Purchase</div>
                            <div class="product-carousel-price">
                                @{
                                    if (item.Discount == 0 || item.Discount == null || item.Discount is string)
                                    {
                                            <ins style="color:red">
                                                @{
                                                string formattedPrice = PhoneShop.Extension.Extension.ToVnd((double)item.Price);
                                                }
                                                @formattedPrice
                                            </ins>
                                    }
                                    else
                                    {
                                            <ins style="color:red">
                                                @{
                                                string formattedPrice = PhoneShop.Extension.Extension.ToVnd((double)item.Discount);
                                                }
                                                @formattedPrice
                                            </ins>
                                    }
                                }

                                @{
                                    string formattedPrice2;
                                    if (item.Discount > 0)
                                    {
                                        formattedPrice2 = PhoneShop.Extension.Extension.ToVnd((double)item.Price);
                                            <del>@formattedPrice2</del>
                                    }
                                }
                            </div>
                        </div>
                    </div>
                   
                }
               
            }

            <!-- Các sản phẩm tiếp theo -->
        </div>
    </div>
</div> <!-- san pham ban chay-->



<div class="product-widget-area">
    <div class="zigzag-bottom"></div>
    <div class="container">
        <div class="row" style="background:white;padding-bottom: 15px;padding:0px 10px">
            <br />
            <div class="product-section-title">
                <b style="font-size:2rem">GỢI Ý HÔM NAY</b>
                <div class="divborder"></div>
                <p style="font-size:1,25rem">Mua Sắm Thả Ga - Không Lo Về Giá!</p>
            </div>


            @if (Model != null)
            {

                foreach (var item in Model)
                {

                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-2">
                        <div class="single-product" style="padding-top:30px">
                            <div class="product-f-image" style="display: flex; justify-content: center; align-items: center;">
                                @*                                         <img src="~/User/img/product-1.jpg" alt="">
                        *@            <img src="~/images/Product/@item.ImageDefaultName" style="height:296px; width:220px" />
                                @* tinh % giam gia *@
                                @if (item.Discount > 0)
                                {
                                    //format discount
                                    decimal discount = 0;
                                    discount = (item.Price - item.Discount) / item.Price * 100;
                                    discount = Math.Round(discount);
                                    //format discount
                                    <div class="discount-label">
                                        <span>Giảm @discount%</span>
                                    </div>
                                }
                                @* tinh % giam gia *@
                                <div class="product-hover">
                                    <a class="add-to-cart-link confirmAdd" data-id="@item.Id"><i class="fa fa-shopping-cart"></i> Thêm vào giỏ</a>
                                    <a href="/chi-tiet/@item.Alias-@item.Id" class="view-details-link"><i class="fa fa-link"></i> Xem chi tiết</a>
                                </div>
                            </div>
                            <div style="height:45px">  <h2><a href="/chi-tiet/@item.Alias-@item.Id">@item.Title</a></h2></div>
                            <div id="stars-container">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    if (i <= Math.Floor(item.Rating))
                                    {
                                        <i class="fa fa-star filled"></i> <!-- Sao đầy -->
                                    }
                                    else if (i == Math.Ceiling(item.Rating))
                                    {
                                        <i class="fa fa-star-half-o half-filled"></i> <!-- Sao nửa -->
                                    }
                                    else
                                    {
                                        <i class="fa fa-star-o"></i> <!-- Sao rỗng -->
                                    }
                                }
                            </div>

                            <div class="product-carousel-price">


                                @{
                                    if (item.Discount == 0 || item.Discount == null || item.Discount is string)
                                    {
                                            <ins style="color:red">
                                                @{






                                                string formattedPrice = PhoneShop.Extension.Extension.ToVnd((double)item.Price);

                                                }
                                                @formattedPrice
                                            </ins>
                                    }
                                    else
                                    {
                                            <ins style="color:red">
                                                @{





                                                string formattedPrice = PhoneShop.Extension.Extension.ToVnd((double)item.Discount);


                                                }
                                                @formattedPrice
                                            </ins>
                                    }
                                }

                                <del>
                                    @{
                                        string formattedPrice2;
                                        if (item.Discount > 0)
                                        {

                                            formattedPrice2 = PhoneShop.Extension.Extension.ToVnd((double)item.Price);
                                        }
                                        else
                                        {


                                            formattedPrice2 = PhoneShop.Extension.Extension.ToVnd((double)tienO);
                                        }


                                    }
                                    @formattedPrice2




                                </del>
                            </div>

                        </div>
                    </div>

                }

            }

            <!-- Các sản phẩm tiếp theo -->
        </div>


    </div>

</div> <!--Tat ca san pham -->
@section Scripts{
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <script>
        $(document).ready(function () {
            $('body').on('click', '.confirmAdd', function () {
                var id = $(this).data('id');





                $.ajax({

                    url: '/Cart/Add',
                    type: 'post',
                    data: { id: id },
                    success: function (rs) {
                        if (rs.success) {
                            alert(rs.msg);

                            location.reload();
                        }
                        else {
                            alert(rs.msg);                          
                        }
                    }

                });


            });


        });
    </script>







}